"use strict";(self.webpackChunkvalex=self.webpackChunkvalex||[]).push([[560],{560:(V,g,a)=>{a.r(g),a.d(g,{PaymentLinkEditModule:()=>q});var f=a(6895),c=a(3022),m=a(4006),_=a(2340),e=a(4650),v=a(2594),x=a(1311),h=a(9549),u=a(1894);function y(o,p){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es obligatorio."),e.qZA())}function k(o,p){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es obligatorio."),e.qZA())}function b(o,p){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es obligatorio."),e.qZA())}function C(o,p){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es obligatorio. "),e.qZA())}function F(o,p){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es obligatorio."),e.qZA())}function Z(o,p){if(1&o&&(e.TgZ(0,"div",32),e._UZ(1,"img",33),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hYB("src","",t.linkImage,"/",t.Image,"",e.LSH)}}function P(o,p){if(1&o){const t=e.EpF();e.TgZ(0,"ngx-dropzone-image-preview",34),e.NdJ("removed",function(){const r=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onRemoveComplement(r))}),e.TgZ(1,"ngx-dropzone-label"),e._uU(2),e.qZA()()}if(2&o){const t=p.$implicit;e.Q6J("file",t)("removable",!0),e.xp6(2),e.AsE("",t.name," (",t.type,") ")}}function T(o,p){1&o&&(e.TgZ(0,"div",35)(1,"label",36),e._uU(2," La imagen no debe ser tener m\xe1s de 700*700 pixeles "),e.qZA()())}const I=function(){return["/payment-link"]};let E=(()=>{class o{constructor(t,i,n,r,l){this.formGroup=t,this.PaymentLinksService=i,this.baseService=n,this.route=r,this.router=l,this.filesComplement=[],this.validate_img=!1,this.widthMin=700,this.heightMin=700,this.dateF="23-10-2022",this.get_id_image=[],this.get_pr=[],this.linkImage=_.N.api.linkImage,this.validate_image=!0,this.inputValue=new m.NI(""),this.taxTypes=[{id:1,description:"19%"},{id:2,description:"0%"}]}ngOnInit(){this.route.params.subscribe(t=>{this.id_link=t.id}),this.linkForm=this.formGroup.group({price:["",[m.kI.required]],reference:["",[m.kI.required]],link_expiration:["",[m.kI.required]],description:["",[m.kI.required]],tax_type:["",[m.kI.required]],total:["",[]]}),this.PaymentLinksService.GetLinkById(this.id_link).subscribe(t=>{this.GetLinkByIdF(t)},t=>{this.baseService.GetErrorAuthSesion(t)})}GetLinkByIdF(t){this.linkForm.get("description")?.setValue(t.data.descripcion);let i=this.formatInputTotal(t.data.subtotal);this.linkForm.get("price")?.setValue(i),this.linkForm.get("tax_type")?.setValue(t.data.tax.id);let n=this.formatInputTotal(t.data.total);this.linkForm.get("total")?.setValue(n),this.total_price=this.formatInputTotal(t.data.total),this.linkForm.get("reference")?.setValue(t.data.cod_producto),this.linkForm.get("link_expiration")?.patchValue(this.formatDate(t.data.end_date)),this.Image=t.data.image,(null==this.Image||""==this.Image)&&(this.validate_image=!1)}formatInput(t){let n=parseFloat(t.target.value.replace(/\D/g,""));isNaN(n)&&(n=0);let r=this.linkForm.value;""==r.tax_type?this.total_price=0:"1"==r.tax_type?(this.total_price=19*n/100,this.total_price=n+this.total_price,this.total_price=this.formatInputTotal(this.total_price)):(this.total_price=0*n/100,this.total_price=n+this.total_price,this.total_price=this.formatInputTotal(this.total_price));const l=n.toLocaleString("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0});this.linkForm.get("price")?.setValue(l,{emitEvent:!1})}formatInputTotal(t){let i=parseFloat(t);return isNaN(i)&&(i=0),i.toLocaleString("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0})}CalcTax(t){const i=t.target;let n=this.linkForm.get("price")?.value.replace(/\D/g,"");"1"==i.value?(this.total_price=19*parseInt(n)/100,this.total_price=parseInt(n)+this.total_price,this.total_price=this.formatInputTotal(this.total_price)):(this.total_price=0*parseInt(n)/100,this.total_price=parseInt(n)+this.total_price,this.total_price=this.formatInputTotal(this.total_price))}submitbutton(){const t=this.linkForm.get("price")?.value.replace(/\D/g,"");if(this.linkForm.get("price")?.setValue(t,{emitEvent:!1}),this.linkForm.valid){let n=this.linkForm.value,r=this.filesComplement.length;const l=this.total_price.replace(/\D/g,"");for(var i=0;i<this.filesComplement.length;i++)this.file=this.filesComplement[i],this.new_file=this.renameFile(this.file,this.Image);const d=new FormData;d.append("codeproduct",n.reference),d.append("description",n.description),d.append("subtotal",n.price),d.append("taxid",n.tax_type),d.append("total",l),r>0&&d.append("image",this.new_file),d.append("_method","PUT"),d.append("enddate",n.link_expiration),this.PaymentLinksService.UpdateLink(d,this.id_link).subscribe(s=>{this.router.navigate(["payment-link"]).then(()=>{})},s=>console.log(s))}else for(let n in this.linkForm.controls)this.linkForm.controls[n].markAsTouched()}renameFile(t,i){return new File([t],i,{type:t.type,lastModified:t.lastModified})}formatDate(t){const i=new Date(t);let n=""+(i.getMonth()+1),r=""+i.getDate();const l=i.getFullYear();return n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),[l,n,r].join("-")}selectFileComplement(t){this.validate_img=!1,t.addedFiles.map(i=>{this.filesComplement.push(i)})}onRemoveComplement(t){this.filesComplement.splice(this.filesComplement.indexOf(t),1)}onValidatePixels(t){return new Promise((i,n)=>{let r=new FileReader;if(t){const l=new Image;l.src=window.URL.createObjectURL(t),r.readAsDataURL(t),r.onload=()=>{const d=l.naturalWidth,s=l.naturalHeight;window.URL.revokeObjectURL(l.src),d<=this.widthMin&&s<=this.heightMin&&i(!0),i(!1)}}})}deleteProduct(t){this.get_id_image.push(t.id_image);let i=this.get_pr;this.get_pr=[];for(var n=0;n<i.length;n++)i[n].id_image!=t.id_image&&this.get_pr.push({id_image:i[n].id_image,image:i[n].image})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.qu),e.Y36(v.r),e.Y36(x.b),e.Y36(c.gz),e.Y36(c.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-payment-link-edit"]],decls:58,vars:17,consts:[[1,"container-fluid"],[1,"breadcrumb-header","justify-content-between"],[1,"left-content"],[1,"main-content-title","mg-b-1","mg-b-lg-1"],[1,"main-dashboard-header-right"],[1,"btn","btn-success-dyner-green","btn-block",3,"routerLink"],[1,"fas","fa-chevron-left"],[1,"row","row-sm"],[1,"col-xl-12"],[1,"card"],[1,"card-body"],[3,"formGroup"],[1,"row"],[1,"col-md-6"],[1,"mg-b-0","tx-14"],["placeholder","Escribe una descripci\xf3n","formControlName","description","maxlength","200","required","",1,"form-control"],[4,"ngIf"],["type","text","placeholder","Digita el valor de tu producto o servicio","formControlName","price","maxlength","150","required","","maxlength","13",1,"form-control"],[1,"col-md-6","mt-2"],["placeholder","Escribe el n\xfamero de referencia","formControlName","reference","maxlength","150","required","","maxlength","15",1,"form-control"],[1,"col-md-4"],["type","text","placeholder","Total","formControlName","total","maxlength","150","maxlength","13","readonly","",1,"form-control",3,"value"],[1,"col-md-4","mt-2"],["formControlName","link_expiration","ng-model","dateF","type","date",1,"form-control",3,"value"],[1,"offset-md-3","col-md-6","mt-4"],["fxLayout","row wrap","fxLayoutAlign","none","class","col-gap div_produc mt-3 mb-3","style","margin-left: 0px",4,"ngIf"],[3,"expandable","disableClick","accept","multiple","change"],["ngProjectAs","ngx-dropzone-preview",5,["ngx-dropzone-preview"],3,"file","removable","removed",4,"ngFor","ngForOf"],["align","center","class","mt-3",4,"ngIf"],["align","center",1,"col-12","col-sm-12","col-lg-12","col-xl-12","mt-4"],[1,"col-md-2"],[1,"btn","btn-success-dyner-green","btn-block",3,"click"],["fxLayout","row wrap","fxLayoutAlign","none",1,"col-gap","div_produc","mt-3","mb-3",2,"margin-left","0px"],["mat-card-image","","alt","Photo",1,"img_size",2,"width","200px","height","201px","margin-left","0px",3,"src"],["ngProjectAs","ngx-dropzone-preview",5,["ngx-dropzone-preview"],3,"file","removable","removed"],["align","center",1,"mt-3"],[2,"color","red"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),e._uU(5," Editar link de pago "),e.qZA()()(),e.TgZ(6,"div",4)(7,"div")(8,"button",5),e._UZ(9,"i",6),e._uU(10," Volver "),e.qZA()()()(),e.TgZ(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"form",11)(16,"div",12)(17,"div",13)(18,"p",14),e._uU(19,"Descripci\xf3n"),e.qZA(),e._UZ(20,"input",15),e.YNc(21,y,2,0,"mat-error",16),e.qZA(),e.TgZ(22,"div",13)(23,"p",14),e._uU(24,"Precio ($) COP"),e.qZA(),e._UZ(25,"input",17),e.YNc(26,k,2,0,"mat-error",16),e.qZA()(),e.TgZ(27,"div",12)(28,"div",18)(29,"p",14),e._uU(30,"Referencia"),e.qZA(),e._UZ(31,"input",19),e.YNc(32,b,2,0,"mat-error",16),e.qZA(),e.TgZ(33,"div",20)(34,"p",14),e._uU(35,"Total ($) COP"),e.qZA(),e._UZ(36,"input",21),e.YNc(37,C,2,0,"mat-error",16),e.qZA()(),e.TgZ(38,"div",12)(39,"div",22)(40,"p",14),e._uU(41,"Vencimiento del link"),e.qZA(),e._UZ(42,"input",23),e.YNc(43,F,2,0,"mat-error",16),e.qZA()(),e.TgZ(44,"div",12)(45,"div",24)(46,"p",14),e._uU(47," Imagen del producto o servicio (opcional) "),e.qZA(),e.YNc(48,Z,2,2,"div",25),e.TgZ(49,"ngx-dropzone",26),e.NdJ("change",function(r){return i.selectFileComplement(r)}),e.TgZ(50,"ngx-dropzone-label"),e._uU(51,"\xa1Suelta tu imagen aqui para actualizar! "),e.qZA(),e.YNc(52,P,3,4,"ngx-dropzone-image-preview",27),e.qZA(),e.YNc(53,T,3,0,"div",28),e.qZA()()(),e.TgZ(54,"div",29)(55,"div",30)(56,"button",31),e.NdJ("click",function(){return i.submitbutton()}),e._uU(57," Editar link de pago "),e.qZA()()()()()()()()),2&t){let n,r,l,d,s;e.xp6(8),e.Q6J("routerLink",e.DdM(16,I)),e.xp6(7),e.Q6J("formGroup",i.linkForm),e.xp6(6),e.Q6J("ngIf",(null==(n=i.linkForm.get("description"))?null:n.hasError("required"))&&(null==(n=i.linkForm.get("description"))?null:n.touched)),e.xp6(5),e.Q6J("ngIf",(null==(r=i.linkForm.get("price"))?null:r.hasError("required"))&&(null==(r=i.linkForm.get("price"))?null:r.touched)),e.xp6(6),e.Q6J("ngIf",(null==(l=i.linkForm.get("reference"))?null:l.hasError("required"))&&(null==(l=i.linkForm.get("reference"))?null:l.touched)),e.xp6(4),e.Q6J("value",i.total_price),e.xp6(1),e.Q6J("ngIf",(null==(d=i.linkForm.get("total"))?null:d.hasError("required"))&&(null==(d=i.linkForm.get("total"))?null:d.touched)),e.xp6(5),e.s9C("value",i.dateF),e.xp6(1),e.Q6J("ngIf",(null==(s=i.linkForm.get("link_expiration"))?null:s.hasError("required"))&&(null==(s=i.linkForm.get("link_expiration"))?null:s.touched)),e.xp6(5),e.Q6J("ngIf",i.validate_image),e.xp6(1),e.Q6J("expandable",!0)("disableClick",!1)("accept","image/*")("multiple",!1),e.xp6(3),e.Q6J("ngForOf",i.filesComplement),e.xp6(1),e.Q6J("ngIf",i.validate_img)}},dependencies:[f.sg,f.O5,c.rH,m._Y,m.Fj,m.JJ,m.JL,m.Q7,m.nD,h.TO,m.sg,m.u,u._f,u.NP,u.sv],styles:[".form-control[_ngcontent-%COMP%]{background-color:#dde2ef;opacity:1;display:block;width:100%;height:inherit;padding:.375rem .75rem;font-size:.875rem;font-weight:400;line-height:1.5;color:#4d5875;background-color:#fff;background-clip:padding-box;border:1px solid #e1e5ef;border-radius:3px;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.mat-error[_ngcontent-%COMP%]{color:#f44336}.mat-form-field[_ngcontent-%COMP%]{display:block;position:relative;text-align:left}  .mat-form-field-wrapper{padding-bottom:0}  .mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-datepicker-toggle-default-icon, .mat-form-field[_ngcontent-%COMP%]:not(.mat-form-field-appearance-legacy)   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-datepicker-toggle-default-icon[_ngcontent-%COMP%]{display:inherit;width:1.5em;height:1.5em}  .mat-form-field-appearance-fill .mat-form-field-flex{border-radius:4px 4px 0 0;padding:0!important}  .mat-form-field-appearance-fill.mat-form-field-disabled .mat-form-field-flex{background-color:#fff}  .mat-form-field-appearance-fill .mat-form-field-infix{padding:0}  .mat-form-field-infix{border-top-width:0px!important}  .mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-datepicker-toggle-default-icon{width:1.5em;height:1.5em}  .mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button, .mat-form-field[_ngcontent-%COMP%]:not(.mat-form-field-appearance-legacy)   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{display:inline-flex;font-size:inherit;width:2.5em;height:2.5em}  .mat-form-field-appearance-fill .mat-form-field-flex{background-color:#fff}  .mat-form-field-appearance-fill{color:#fff!important}  .mat-input-underline{display:none}  .mat-form-field-appearance-legacy .mat-form-field-underline{height:0!important}  .mat-form-field-appearance-legacy .mat-form-field-wrapper{padding-bottom:0}  .mat-form-field-appearance-legacy .mat-form-field-infix{padding:0}  .mat-form-field.mat-warn .mat-input-element, .mat-form-field-invalid[_ngcontent-%COMP%]   .mat-input-element[_ngcontent-%COMP%]{caret-color:#fff!important}  .mat-form-field-underline{display:none}.img_size[_ngcontent-%COMP%]{border-radius:8%}"]}),o})();var L=a(529);const A=[{path:"",children:[{path:"",title:"Dyner - Link de pago",component:E}]}];let w=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[c.Bz.forChild(A),L.JF,m.u5,c.Bz]}),o})();var U=a(6205),O=a(3333),M=a(2834),z=a(3626),N=a(1066),D=a(1844),J=a(769);let q=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[f.H9],imports:[f.ez,w,U.X,O.IJ,M.z,m.u5,z.p0,N.x,m.UX,h.lN,D.Ti,u.bB,J.zh]}),o})()}}]);